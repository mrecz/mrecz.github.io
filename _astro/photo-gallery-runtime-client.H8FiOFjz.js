import{j as t}from"./jsx-runtime.D_zvdyIk.js";import{r as s}from"./index.RH_Wq4ov.js";import{u as D,a as V,b as W,c as R,A as F,d as S,e as T,f as z,g as M,r as B,h as I,C as G,i as $,L as H}from"./index.DNyClrR_.js";/* empty css                       */import"./index.nqNQovPP.js";const O={controls:!0,playsInline:!0},k=r=>({...O,...r});function Y(){const{video:r}=R();return k(r)}function K(){var r;return((r=navigator.userAgentData)===null||r===void 0?void 0:r.brands.some(({brand:n})=>n==="Chromium"))||!!window.chrome}function X(){return/^((?!chrome|android).)*(safari|mobile)/i.test(navigator.userAgent)}function Z({slide:r,offset:n}){const h=Y(),{publish:g}=D(),{setContainerRef:P,containerRect:a,containerRef:m}=V(),{getOwnerDocument:o}=W(),{animation:v}=R(),l=s.useRef(null),f=s.useRef(!1);s.useEffect(()=>{n!==0&&l.current&&!l.current.paused&&l.current.pause()},[n]),s.useEffect(()=>{n===0&&l.current&&(r.autoPlay||h.autoPlay)&&(g(F),l.current.play().catch(()=>{}))},[n,h.autoPlay,r.autoPlay,g]);const c=S(()=>{const e=setTimeout(()=>{if(m.current){const u=m.current.style.border;m.current.style.border="1px solid transparent",B(m.current),m.current.style.border=u}},Math.max(v.swipe,v.navigation||0)+50);return()=>clearTimeout(e)});s.useEffect(()=>{if(K()&&n===0)return c()},[n,c]);const p=S(e=>{n===0&&(h.autoPlay||r.autoPlay)&&e.paused&&e.play().catch(()=>{})}),E=s.useCallback(e=>{l.current=e,e&&p(e)},[p]);s.useEffect(()=>{if(n===0){let e=!1;const u=()=>{e=o().fullscreenElement===l.current,f.current=e};return o().addEventListener("fullscreenchange",u),()=>{o().removeEventListener("fullscreenchange",u),e&&(f.current=!1,o().exitFullscreen().catch(()=>{}))}}},[n,o]),s.useEffect(()=>{if(n===0){let e=!1;const u=_=>A=>{A.target===l.current&&(e=_,f.current=e)},x=u(!0),j=u(!1);return o().addEventListener("enterpictureinpicture",x),o().addEventListener("leavepictureinpicture",j),()=>{o().removeEventListener("enterpictureinpicture",x),o().removeEventListener("leavepictureinpicture",j),e&&(f.current=!1,o().exitPictureInPicture().catch(()=>{}))}}},[n,o]);const{width:d,height:i,poster:y,sources:b}=r,L=()=>{const e={};if(e.style={maxWidth:"100%",maxHeight:"100%"},d&&i&&a){const u=d/i>a.width/a.height,x=u?a.width:Math.round(a.height/i*d),j=u?Math.round(a.width/d*i):a.height;e.width=x,e.height=j,e.style.width=x,e.style.height=j}return e},w=e=>r[e]===!1?null:r[e]===!0?{[e]:!0}:h[e]===!1?null:h[e]===!0?{[e]:!0}:null,N=e=>h[e]||r[e]?{[e]:r[e]||h[e]}:null,C=e=>{f.current&&e.stopPropagation()};return s.createElement(s.Fragment,null,b&&s.createElement("div",{ref:P,style:{width:"100%",height:"100%",...d?{maxWidth:`${d}px`}:null},className:T(I("video_container"),I($),I(G))},a&&s.createElement("video",{ref:E,poster:y,...L(),...w("controls"),...w("playsInline"),...w("loop"),...w("muted"),...w("playsInline"),...w("disablePictureInPicture"),...w("disableRemotePlayback"),...N("controlsList"),...N("crossOrigin"),...N("preload"),onPlay:()=>{var e;if(n!==0){(e=l.current)===null||e===void 0||e.pause();return}g(M)},onEnded:()=>{g(z)},onWheel:C,onKeyDown:C,onPointerDown:e=>{C(e),X()&&l.current&&l.current.getBoundingClientRect().bottom-e.clientY<40&&e.stopPropagation()}},b.map(({src:e,type:u,media:x})=>s.createElement("source",{key:[e,u,x].filter(Boolean).join("|"),src:e,type:u,media:x})))))}function q(r){return r.type==="video"}function J({augment:r}){r(({render:{slide:n,...h},video:g,...P})=>({render:{slide:({slide:a,offset:m,rect:o})=>{var v;return q(a)?s.createElement(Z,{key:(v=a.sources)===null||v===void 0?void 0:v.map(l=>l.src).join("|"),slide:a,offset:m}):n?.({slide:a,offset:m,rect:o})},...h},video:k(g),...P}))}function ne(){const[r,n]=s.useState([]),[h,g]=s.useState([]),[P,a]=s.useState(!0),[m,o]=s.useState(null),[v,l]=s.useState(-1);return s.useEffect(()=>{(async()=>{try{a(!0),o(null);const c=await fetch("/api/gallery-images");if(!c.ok)throw new Error(`Failed to fetch images: ${c.status}`);const p=await c.json(),E=[],d=[];for(const i of p)try{if(i.type==="image"){const y=new Image;await new Promise((b,L)=>{y.onload=b,y.onerror=L,y.src=i.path}),E.push({src:i.path,width:y.naturalWidth,height:y.naturalHeight,type:"image"}),d.push({src:i.path})}else i.type==="video"&&(E.push({src:i.path,width:800,height:600,type:"video"}),d.push({type:"video",sources:[{src:i.path,type:"video/mp4"}]}))}catch(y){console.warn(`Failed to load ${i.type} ${i.name}:`,y),E.push({src:i.path,width:800,height:600,type:i.type}),i.type==="video"?d.push({type:"video",sources:[{src:i.path,type:"video/mp4"}]}):d.push({src:i.path})}n(E),g(d)}catch(c){console.error("Error loading gallery images:",c),o(c instanceof Error?c.message:"Failed to load images");const p=[{src:"/placeholder-image.png",width:800,height:600,type:"image"}];n(p),g([{src:p[0].src}])}finally{a(!1)}})()},[]),P?t.jsx("div",{className:"relative overflow-hidden w-full h-full py-20 flex items-center justify-center",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-carmine-700 mx-auto mb-4"}),t.jsx("p",{className:"text-stone-600",children:"Načítám galerii..."})]})}):m?t.jsx("div",{className:"relative overflow-hidden w-full h-full py-20 flex items-center justify-center",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-red-600 mb-4",children:t.jsx("svg",{className:"w-12 h-12 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),t.jsx("p",{className:"text-red-600 mb-2",children:"Chyba při načítání galerie"}),t.jsx("p",{className:"text-stone-500 text-sm",children:m}),t.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-carmine-700 text-white rounded-lg hover:bg-carmine-800 transition-colors",children:"Zkusit znovu"})]})}):t.jsxs("div",{className:"relative overflow-hidden w-full h-full py-20",children:[t.jsx("div",{className:"styled-gallery",children:t.jsx("div",{className:"masonry-grid",children:r.map((f,c)=>t.jsx("div",{className:"masonry-item",onClick:()=>l(c),children:f.type==="video"?t.jsxs("div",{className:"video-wrapper",children:[t.jsx("video",{src:f.src,className:"gallery-video",preload:"metadata",muted:!0,loop:!0,onMouseEnter:p=>p.currentTarget.play(),onMouseLeave:p=>p.currentTarget.pause(),children:"Your browser does not support the video tag."}),t.jsx("div",{className:"video-play-overlay",children:t.jsx("svg",{className:"play-icon",viewBox:"0 0 24 24",fill:"currentColor",children:t.jsx("path",{d:"M8 5v14l11-7z"})})})]}):t.jsx("img",{src:f.src,alt:`Gallery item ${c+1}`,className:"gallery-image"})},c))})}),t.jsx(H,{plugins:[J],index:v,slides:h,open:v>=0,close:()=>l(-1)})]})}export{ne as PhotoGalleryRuntimeClient};
